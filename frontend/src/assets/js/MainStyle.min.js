// Replace content in .logo-header
var logoHeaderElement = document.querySelector(".sidebar .logo-header");
var logoHeaderContent = logoHeaderElement ? logoHeaderElement.innerHTML : "";

function layoutsColors() {
    var sidebar = document.querySelector(".sidebar");
    if (sidebar && sidebar.hasAttribute("data-background-color")) {
        document.documentElement.classList.add("sidebar-color");
    } else {
        document.documentElement.classList.remove("sidebar-color");
    }
}

function customBackgroundColor() {
    document.querySelectorAll('[data-background-color="custom"]').forEach(function (element) {
        if (element.hasAttribute("custom-color")) {
            element.style.background = element.getAttribute("custom-color");
        } else if (element.hasAttribute("custom-background")) {
            element.style.backgroundImage = `url(${element.getAttribute("custom-background")})`;
        }
    });
}

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (event) {
            var imgPreview = input.closest(".input-file-image")?.querySelector(".img-upload-preview");
            if (imgPreview) {
                imgPreview.src = event.target.result;
            }
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function showPassword(button) {
    var input = button.parentElement.querySelector("input");
    if (input) {
        input.type = input.type === "password" ? "text" : "password";
    }
}

function toggleSidebar() {
    const wrapper = document.querySelector(".wrapper");
    const toggleButton = document.querySelector(".toggle-sidebar");
    let isSidebarMinimized = wrapper.classList.contains("sidebar_minimize");

    if (toggleButton) {
        toggleButton.addEventListener("click", () => {
            if (isSidebarMinimized) {
                wrapper.classList.remove("sidebar_minimize");
                toggleButton.classList.remove("toggled");
                toggleButton.innerHTML = '<i class="gg-menu-right"></i>';
                isSidebarMinimized = false;
            } else {
                wrapper.classList.add("sidebar_minimize");
                toggleButton.classList.add("toggled");
                toggleButton.innerHTML = '<i class="gg-more-vertical-alt"></i>';
                isSidebarMinimized = true;
            }
        });
    }
}

window.addEventListener("DOMContentLoaded", function () {
    layoutsColors();
    customBackgroundColor();
    toggleSidebar();

    document.querySelectorAll(".btn-refresh-card").forEach(function (button) {
        button.addEventListener("click", function () {
            var card = button.closest(".card");
            if (card) {
                card.classList.add("is-loading");
                setTimeout(function () {
                    card.classList.remove("is-loading");
                }, 3000);
            }
        });
    });

    var searchNav = document.querySelector("#search-nav");
    if (searchNav) {
        searchNav.addEventListener("shown.bs.collapse", function () {
            var navSearchInput = document.querySelector(".nav-search .form-control");
            if (navSearchInput) {
                navSearchInput.focus();
            }
        });
    }

    // Sidebar toggler
    let sidenavToggler = document.querySelector(".sidenav-toggler");
    let isNavOpen = false;
    if (sidenavToggler) {
        sidenavToggler.addEventListener("click", function () {
            if (isNavOpen) {
                document.documentElement.classList.remove("nav_open");
                sidenavToggler.classList.remove("toggled");
                isNavOpen = false;
            } else {
                document.documentElement.classList.add("nav_open");
                sidenavToggler.classList.add("toggled");
                isNavOpen = true;
            }
        });
    }

    // Quick-sidebar toggler
    let quickSidebarToggler = document.querySelector(".quick-sidebar-toggler");
    let isQuickSidebarOpen = false;
    if (quickSidebarToggler) {
        quickSidebarToggler.addEventListener("click", function () {
            if (isQuickSidebarOpen) {
                document.documentElement.classList.remove("quick_sidebar_open");
                document.querySelector(".quick-sidebar-overlay")?.remove();
                quickSidebarToggler.classList.remove("toggled");
                isQuickSidebarOpen = false;
            } else {
                document.documentElement.classList.add("quick_sidebar_open");
                quickSidebarToggler.classList.add("toggled");
                let overlay = document.createElement("div");
                overlay.className = "quick-sidebar-overlay";
                document.body.appendChild(overlay);
                isQuickSidebarOpen = true;
            }
        });
    }
});
